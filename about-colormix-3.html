<!doctype html> <meta charset=utf-8> <title>About Co!orMix (3) - Co!orMix 小记：关于开发的那点儿事 - Perfect Freeze!</title> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=description content="关于 Co!orMix 前几天， Cee 童鞋把 Co!orMix 开源了。当时刚上架的时候，团队里的另外两个童鞋都发了文，@Cee 讲产品，@Albus 讲设计（这两篇文章都在 V2EX 上发布过）。 既然代码开源了，那是时候说一下项目本身了。 Co!orMix 里面并没有什么特别有技术含量的东西，可以说，任何一个人都可以毫不费力地把它做出来。对于新手来说，也值得一试。不过毫不谦虚地说，如果要达到零错误率，还是有一定难度的，而上线至今，它的 Crash 率一直保持在 0 ，这是我所引以为豪的。（欢迎大家试玩！偷偷说一句，我可是跟组里承诺过，只要出现一个 crash ，就请吃饭的哦！） ..."> <meta name=theme-color content=#54C7FC> <link rel=alternate href=/feed.xml type=application/atom+xml> <link rel=apple-touch-icon href=/apple-touch-icon.png> <link rel=manifest href=/manifest.json> <style>*,:after,:before{padding:0;margin:0;box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;text-rendering:optimizelegibility;image-rendering:optimizequality;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:#fff}body{padding:0 24vw;margin:0 auto 0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;font-size:1.6vw;line-height:1.42857143;hanging-punctuation:first allow-end;color:#000;background:#fff;transition:all .2s ease}@media (max-width:1080px){body{padding-left:8vw;padding-right:8vw;font-size:2.24vw}}@media (max-width:640px){body{padding-left:4vw;padding-right:4vw;font-size:3.84vw}}@media (max-width:400px){body{font-size:5.12vw}}a{color:#000;text-decoration:none;transition:color .5s ease,border-color .5s ease,background .5s ease,opacity 1.5s ease}a:focus,a:hover{transition:color .1s ease,border-color .1s ease,background .1s ease,opacity .1s ease;text-decoration:underline;-webkit-text-decoration-skip:ink;text-decoration-skip:ink}img{border:0}:-ms-input-placeholder{color:#000;opacity:.2}::placeholder{color:#000;opacity:.2}:focus:-ms-input-placeholder{color:#6cb5fc}:focus::placeholder{color:#6cb5fc}.js-system--apple{font-feature-settings:"case","ss01","ss02"}.navigation{padding-top:1.4vmax;padding-bottom:1.4vmax;margin-right:-1vmax;margin-left:-1vmax;font-size:60%;font-weight:700;letter-spacing:.45em;text-transform:uppercase}.navigation li{display:inline-block;line-height:2;list-style:none}.navigation li a{padding:.5em 1vmax}.navigation li a:focus,.navigation li a:hover{color:#6cb5fc;text-decoration:none}.content{margin-bottom:16vmin}.content:after,.content:before{display:table;content:""}.content:after{clear:both}.content article>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child>:last-child>:last-child{margin-bottom:0!important}.content .post-content>:first-child{margin-top:0}.content a{font-weight:700}.content a:has(>code){-webkit-text-decoration-color:#54c7fc;text-decoration-color:#54c7fc}.content p{margin-bottom:1.6rem;line-height:1.71428571}.content header{display:flex;min-height:calc(100vh - 5.6vmax - 5ex);padding-top:10vmin;padding-bottom:10vmin;margin-bottom:16vmin;flex-direction:column;justify-content:center;background:rgba(0,0,0,.02);padding-left:24vw;padding-right:24vw;margin-left:-24vw;margin-right:-24vw}@media (max-width:1080px){.content header{min-height:calc(50vh - 1.4vmax * 2 - 3ex);padding-top:16vmin;padding-bottom:16vmin;padding-left:8vw;padding-right:8vw;margin-left:-8vw;margin-right:-8vw}}@media (max-width:640px){.content header{padding-left:4vw;padding-right:4vw;margin-left:-4vw;margin-right:-4vw}}.content header h1{font-size:360%;font-weight:700;letter-spacing:-.04em;margin-left:-2px;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.1}@media (max-width:640px){.content header h1{font-size:280%}}.content header small{display:block;margin-top:2vmin}.content h2{margin:10vmin 0 1rem;font-size:72%;font-weight:400;opacity:.5}.content ul{margin-bottom:1.8rem;list-style:none;counter-reset:list}@media (max-width:640px){.content ul{margin-left:1em}}.content ul li{line-height:1.71428571}.content ul li:before{position:absolute;display:inline-block;width:4em;margin-top:1px;margin-left:-4em;font-size:80%;line-height:2.14285714;text-align:right;opacity:.6;pointer-events:none}.content ul li:before{content:"•";padding-right:.6em}.content img{display:block;width:calc(100% + (8vw * 2));margin:0 -8vw 1.8rem}@media (max-width:1080px){.content img{width:calc(100% + (8vw * 2));margin-left:-8vw;margin-right:-8vw}}@media (max-width:640px){.content img{width:calc(100% + (4vw * 2));margin-left:-4vw;margin-right:-4vw}}.content code,.content pre{font-family:Menlo,Consolas,monospace;color:#54c7fc}.content pre{background:rgba(0,136,255,.04)}.content code{font-size:92%;overflow-wrap:break-word}.content pre{padding:1.2vw;margin-left:-1.2vw;margin-right:-1.2vw;margin-bottom:1.8rem;overflow-x:auto;font-size:80%;line-height:1.71428571;-webkit-overflow-scrolling:touch}@media (max-width:1080px){.content pre{padding-left:8vw;padding-right:8vw;margin-left:-8vw;margin-right:-8vw}}@media (max-width:640px){.content pre{padding-left:4vw;padding-right:4vw;margin-left:-4vw;margin-right:-4vw}}.content pre code{overflow-wrap:normal}.content table{border-collapse:collapse;border-spacing:0;font-size:90%;width:100%;margin-left:-1.2vw;margin-right:-1.2vw;margin-bottom:1.8rem}@media (max-width:1080px){.content table{width:calc(100% + (8vw * 2));margin-left:-8vw;margin-right:-8vw}}@media (max-width:640px){.content table{width:calc(100% + (4vw * 2));margin-left:-4vw;margin-right:-4vw}}.content table td,.content table th{padding:.6em 1.2vw}.content table td:first-child,.content table th:first-child{padding-left:1.2vw}.content table td:last-child,.content table th:last-child{padding-right:1.2vw}@media (max-width:1080px){.content table td:first-child,.content table th:first-child{padding-left:8vw}.content table td:last-child,.content table th:last-child{padding-right:8vw}}@media (max-width:640px){.content table td:first-child,.content table th:first-child{padding-left:4vw}.content table td:last-child,.content table th:last-child{padding-right:4vw}}.content table th{border-bottom:2px solid rgba(0,0,0,.06);text-align:left}.content table td{border-top:1px solid rgba(0,0,0,.04)}.footer{padding:0 0 16vmin;font-size:75%;text-transform:lowercase}.footer ul li{display:inline}.footer ul li:after{padding:0 1vmax;content:" / ";opacity:.3}.footer ul li:last-child:after{content:none}@media print{*,:after,:before{background:0 0!important;color:#000!important;box-shadow:none!important;text-shadow:none!important}body{padding:10mm!important;margin:0!important}a,a:visited{text-decoration:none}.content header{min-height:0;padding-bottom:0}.content .post-content{max-width:100%!important}.content .post-content a[href]:after{content:" (" attr(href) ")";font-weight:400}pre{page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,p{orphans:3;widows:3}h2{page-break-after:avoid}.footer,.navigation{display:none}}.content h2{font-size:108%;opacity:.8}.navigation{text-align:center}#disqus_thread{margin-top:20px}</style> <link rel=canonical href=http://blog.cee.moe/about-colormix-3.html> <meta property=og:type content=article> <meta property=og:site_name content="Perfect Freeze!"> <meta property=og:title content="About Co!orMix (3) - Co!orMix 小记：关于开发的那点儿事"> <meta property=og:url content=http://blog.cee.moe/about-colormix-3.html> <meta property=og:description content="关于 Co!orMix 前几天， Cee 童鞋把 Co!orMix 开源了。当时刚上架的时候，团队里的另外两个童鞋都发了文，@Cee 讲产品，@Albus 讲设计（这两篇文章都在 V2EX 上发布过）。 既然代码开源了，那是时候说一下项目本身了。 Co!orMix 里面并没有什么特别有技术含量的东西，可以说，任何一个人都可以毫不费力地把它做出来。对于新手来说，也值得一试。不过毫不谦虚地说，如果要达到零错误率，还是有一定难度的，而上线至今，它的 Crash 率一直保持在 0 ，这是我所引以为豪的。（欢迎大家试玩！偷偷说一句，我可是跟组里承诺过，只要出现一个 crash ，就请吃饭的哦！） ..."> <meta property=og:image content=http://i1.tietuku.com/52bcba6e61024850.png> <meta name=twitter:card content=summary_large_image> <meta name=twitter:site content=@Ceecirno> <meta name=twitter:creator content=@Ceecirno> <meta property=article:published_time content=2015-09-10T00:00:00-07:00> <meta property=article:modified_time content=2015-09-10T00:00:00-07:00> <meta name=twitter:label1 value=Words> <meta name=twitter:data1 value="512 words"> <meta name=twitter:label2 value="Reading time"> <meta name=twitter:data2 value="2 mins"> <nav class=navigation> <ul> <li> <a href=/ > Home </a> </li> <li> <a href=/articles/ > Articles </a> </li> <li> <a href=/works/ > Works </a> </li> <li> <a href=/friends/ > Friends </a> </li> <li> <a href=/about/ > About </a> </li> </ul> </nav> <main class=content role=main> <article> <header> <h1 title="About Co!orMix (3) - Co!orMix 小记：关于开发的那点儿事" data-title="About Co!orMix (3) - Co!orMix 小记：关于开发的那点儿事"> About Co!orMix (3) - Co!orMix 小记：关于开发的那点儿事<span class="dot dot--post"> </span> </h1> <small> By <span rel=author>Cee</span> on <time datetime=2015-09-10T00:00:00-07:00>Sep 10, 2015</time> </small> </header> <div class=post-content> <h2 id=关于-coormix>关于 Co!orMix</h2> <p>前几天， Cee 童鞋把 <a href=https://github.com/Cee/ColorMix>Co!orMix</a> 开源了。当时刚上架的时候，团队里的另外两个童鞋都发了文，@Cee 讲<a href=http://blog.cee.moe/about-colormix-1.html>产品</a>，@Albus 讲<a href=http://blog.cee.moe/about-colormix-2.html>设计</a>（这两篇文章都在 V2EX 上发布过）。</p> <p>既然代码开源了，那是时候说一下项目本身了。</p> <p>Co!orMix 里面并没有什么特别有技术含量的东西，可以说，任何一个人都可以毫不费力地把它做出来。对于新手来说，也值得一试。不过毫不谦虚地说，如果要达到零错误率，还是有一定难度的，而上线至今，它的 Crash 率一直保持在 0 ，这是我所引以为豪的。（欢迎大家试玩！偷偷说一句，我可是跟组里承诺过，只要出现一个 crash ，就请吃饭的哦！）</p> <h2 id=动手之前的思考>动手之前的思考</h2> <p>无论是多简单的项目，开动之前必须要思考一下大致的架构。 Co!orMix 本身是一个相对很简单的游戏。</p> <p>从页面考虑：<strong>主页、设置页、游戏界面、游戏结果页、引导页</strong>； 从游戏本身考虑：<strong>题目、选项、得分、策略、游戏模式</strong>。</p> <p>第一天晚上我们三个人商量出了游戏的大致功能和规则，我和 Cee 便直接开始讨论起了实现。由于游戏本身的复杂度不高，我们决定采用最传统的 MVC 来完成这个应用。</p> <ul> <li> <p>Model 层<br> CMCard ：卡片（对应游戏界面上半部分） CMColor ：颜色（游戏中所对应的颜色的概念） CMQuestion ：问题（包含 CMCard ，以及对应的 Option 和 Answer ） CMScene ：游戏场景（对应一次游戏，根据游戏模式区分不同表现） Factory ：工厂（工厂模式，生产问题）</p> </li> <li> <p>View 层 <br> CMCardView ：卡片 View CMQuestionView ：问题 View CMScoreView ：得分</p> </li> <li> <p>Controller 层<br> CMClassicTutorialViewController/CMFantasyTutorialViewController ：新手引导 CMGameResultViewController ：游戏结果 CMGameViewController ：游戏界面 CMMenuViewController ：游戏菜单界面 CMSettingViewController ：游戏设置界面</p> </li> </ul> <h2 id=项目结构>项目结构</h2> <p>由于项目比较简单，所以并没有按照功能模块进行分类，项目的结构大致如下：</p> <table> <thead> <tr> <th>目录</th> <th style=text-align:right>职能</th> </tr> </thead> <tbody> <tr> <td>Category</td> <td style=text-align:right>工具、扩展类</td> </tr> <tr> <td>ViewController</td> <td style=text-align:right>Controller 层</td> </tr> <tr> <td>View</td> <td style=text-align:right>View 层</td> </tr> <tr> <td>Model</td> <td style=text-align:right>Model 层</td> </tr> </tbody> </table> <p>项目并没有使用任何第三方库（除了友盟统计），所以自然也就没有使用 Cocoapods 了。</p> <h2 id=关于开发细节>关于开发细节</h2> <ul> <li>规范</li> </ul> <p>项目主体编码主要是我负责的，@Cee 在初期做了 Code Review 工作（惊讶吧！这么小的项目还做 Code Review ）。开发在 <code class=highlighter-rouge>dev</code> 分支做，记得第一次提交的时候，@Cee 写了 N 个 comments ，很多都是关于 Coding Style 的问题（我自认已经很注意了，但是在某个人的强迫症面前根本不值一提），改完了所有的问题。之后就更加小心地完成编码工作。最后通过 <code class=highlighter-rouge>Pull Request</code> 合并进主分支。之后又开发了 Android 版本，感兴趣的童鞋可以去 <code class=highlighter-rouge>dev_android</code> 的分支看一下安卓版本，实现的大致逻辑和 iOS 差不多。</p> <ul> <li>适配</li> </ul> <p>项目采用 xib + AutoLayout + Size Classes 完成界面搭建，这也是我们第一次尝试使用 Size Classes 。<br> 总体来说，算是不错的一次实践， 0 代码完成全平台适配。我们以游戏界面中的 QuestionView 为例（<code class=highlighter-rouge>CMQuestionView</code>）做一下介绍，这个界面算是相当相当的典型了！</p> <p><img src=http://i1.tietuku.com/52bcba6e61024850.png alt=""></p> <p>分析一下这个界面，基本可以分三部分：卡片、问题、选项。这里我总共分了三个 View 来区分，分别为 Options 、 Card 、 Question ，其中 Options 是撑满整个 View 的。（参看 Fantasy 模式下的表现）</p> <p>可以注意一下这里还有一个<code class=highlighter-rouge>背景占位符</code>，它是一个垫在最底层撑满整个屏幕的透明的 View ，用来给其他 subview 做尺寸上的参考，比如 <code class=highlighter-rouge>Card</code> 部分的高度所做的约束通过<code class=highlighter-rouge>背景占位符</code>高度的一半来限定。</p> <p>另外分享一个小的 Tip ，在 xib 中可以直接通过右侧的选项实时查看不同设备下界面的布局： <img src=http://i1.tietuku.com/e99ed1152bc639c7.png alt=""><br> <img src=http://i1.tietuku.com/b97cebd4bed9c827.png alt=""></p> <p>再有就是 Tutorial 的这个界面，细心的用户也会发现也是全适配的。我们的游戏引导界面并没有单纯地使用图片，而是在原有的游戏界面上加上了对应的引导元素，不管是箭头还是文字都是使用 AutoLayout 拉的约束。 <img src=http://i3.tietuku.com/502655f9c3df74d0.png alt=""><br> <img src=http://i3.tietuku.com/49eb9ed47eb6ab93.png alt=""></p> <ul> <li>分享</li> </ul> <p>为求最简，我们的分享使用的系统原生的 <code class=highlighter-rouge>UIActivityViewController</code> 来实现。不过这里在适配的时候遇到了个坑，直接上代码：</p> <pre><code class=language-objective-c>- (IBAction )onShareButtonClicked:(id )sender {
    [MobClick event:@"Share"];
    CMScoreView *scoreView = [[CMScoreView alloc] initWithScore:self.score];
    UIImage *imageToShare = [UIImage captureImageFromView:scoreView];
    NSString *stringToShare = [NSString stringWithFormat:@"I scored %ld in the %@ mode, play #Co!orMix with me: %@", (long )self.score, self.gameMode == classicMode ? @"classic" : @"fantasy" , kAppStoreUrl ];
    NSArray *activityItems = [[NSArray alloc] initWithObjects:imageToShare,stringToShare, nil];
    UIActivityViewController *activityVC = [[UIActivityViewController alloc] initWithActivityItems:activityItems applicationActivities:nil];
    activityVC.excludedActivityTypes = @[UIActivityTypeSaveToCameraRoll];
    if (IS_IPAD ) {
        UIPopoverController *popup = [[UIPopoverController alloc] initWithContentViewController:activityVC];
        self.shareController = popup;
        popup.delegate = self;
        [popup presentPopoverFromRect:CGRectMake (self.view.frame.size.width / 2, self.shareBtn.frame.size.height + self.shareBtn.frame.origin.y , 0, 0 )inView:self.view permittedArrowDirections:UIPopoverArrowDirectionUp animated:YES];
    } else {
        [self presentViewController:activityVC animated:YES completion:nil];
    }
}
</code></pre> <p>对于 <code class=highlighter-rouge>UIActivityViewController</code>，在 <code class=highlighter-rouge>iPhone</code> 上，我们可以直接使用 <code class=highlighter-rouge>present</code> 的方式；但是在 <code class=highlighter-rouge>iPad</code> 上，这会引起崩溃，可以使用 <code class=highlighter-rouge>UIPopoverController</code> 来包装 <code class=highlighter-rouge>UIActivityViewController</code>。</p> <ul> <li>设置界面的效果</li> </ul> <p><img src=http://i3.tietuku.com/b7debc4a2f13ac8a.png alt=""></p> <p>个人还是很喜欢这个效果的，使用的是 iOS8 自带的毛玻璃效果。上代码：</p> <pre><code class=language-objective-c>- (IBAction )onSettingButtonClicked:(id )sender {
    [MobClick event:@"Setting"];
    self.settingViewController = [[CMSettingViewController alloc] initWithNibName:NSStringFromClass ([CMSettingViewController class]) bundle:nil];
    self.settingViewController.view.frame = self.view.bounds;
    self.settingViewController.view.alpha = 0;
    [self.view addSubview:self.blurView];
    [self.view addSubview:self.settingViewController.view];
    [self addChildViewController:self.settingViewController];
    [UIView animateWithDuration:0.3 delay:0 options:UIViewAnimationOptionCurveEaseInOut animations:^{
        _blurView.alpha = 1;
        self.settingViewController.view.alpha = 1;
    } completion:nil];
}

- (UIView *)blurView {
    if (!_blurView ) {
        _blurView = [[UIVisualEffectView alloc] initWithEffect:[UIBlurEffect effectWithStyle:UIBlurEffectStyleDark]];
        _blurView.frame = [[UIScreen mainScreen] bounds];
        _blurView.alpha = 0;
    }
    return _blurView;
}
</code></pre> <ul> <li>GameCenter 和友盟</li> </ul> <p>这两块都是 @Cee 负责弄的。友盟的接入相对简单，不过 GameCenter @Cee 弄了一晚上，还吐槽网上没有成熟的 GameCenter 接入指南，我觉得有必要让他专门写一份了。</p> <ul> <li>面向对象</li> </ul> <p>项目虽小，可以用任何方式实现。不过这样一个小项目可以把面向对象思想很好地加以实践。所有的类都实现了对应的职能，隐藏了内部细节。</p> <h2 id=总结>总结</h2> <p>以前写过不少项目，不过都比较庞大，而且基本都是负面教材。 Co!orMix 是一个小而精的 App ，从萌生想法，到 Demo ，到设计出炉正式完工，整个周期一共就一星期：设计花了一整天做出了可供交互的原型；在代码上只花了两天，但是却不仓促。代码均在 GitHub 上托管，测试上使用 TestFlight 完成分发，通过种子用户的体验修改游戏参数，提高用户体验。同时兼顾各种极端操作，保证代码安全性，做到零错误率。</p> <p>简单来说，对于新手来说，大家可以先下一下这个 App ，感兴趣的可以自己实现一遍，一点都不困难！然后再对比一下我们的实现。如果 Co!orMix 有任何不合理的地方，也欢迎指正！</p> <p>最后欢迎大家体验！</p> <ul> <li> <p>Website: http://colormix.cee.moe</p> </li> <li> <p>Twitter: <a href=https://twitter.com/ColorMix_Game>@ColorMix_Game</a></p> </li> <li> <p><a href="https://itunes.apple.com/us/app/co!ormix/id1011677035?ls=1&amp;mt=8">戳我进入 iTunes 下载</a></p> </li> <li> <p>二维码下载：</p> <p><img src=http://ww3.sinaimg.cn/thumbnail/aa266f4dgw1etqjoifoi2j20b40b4q4p.jpg alt=二维码></p> </li> </ul> </div> </article> </main> <footer class=footer> <ul> <li><a href=/ >Perfect Freeze!</a></li> <li><a href=https://github.com/Cee title=GitHub>GitHub</a></li> <li><a href=https://github.com/PerfectFreeze title="Perfect Freeze - Lab">Lab</a></li> <li><a href=/feed.xml title="Feed - Atom (The Atom Syndication Format)">Atom</a></li> </ul> <div id=disqus_thread></div> <script type=text/javascript>var disqus_shortname="perfectfreeze";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script> <noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </footer> <script>navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&document.body.classList.add("js-system--apple")</script> <script></script> <script>"serviceWorker"in navigator&&"blog.cee.moe"===window.location.hostname&&navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})</script> <script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-48656879-8","auto"),ga("send","pageview")</script>