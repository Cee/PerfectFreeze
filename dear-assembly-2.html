 <!doctype html> <meta charset=utf-8> <title>Dear Assembly（2） · Perfect Freeze!</title> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=description content=继续我们的拆炸弹之旅~> <link rel=alternate href=/feed.xml type=application/atom+xml> <link rel=icon href=/favicon.ico> <link rel=apple-touch-icon href=/apple-touch-icon.png> <link rel=mask-icon href=/favicon.svg color=#54C7FC> <style>body,html{background:#fff}.navigation{font-weight:700}.content:after{clear:both}*,:after,:before{box-sizing:border-box;margin:0;padding:0}html{font-size:100%;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;text-rendering:optimizelegibility;image-rendering:optimizequality}body{font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue','Hiragino Sans GB',Arial,sans-serif;font-size:1.6vw;line-height:1.42857143;margin:0 auto;padding:0 22vw;transition:all .2s ease;color:#000;font-feature-settings:'case','ss01','ss02'}@media (max-width:1080px){body{font-size:2.24vw;padding-right:8vw;padding-left:8vw}}@media (max-width:640px){body{font-size:3.84vw;padding-right:4vw;padding-left:4vw}}@media (max-width:400px){body{font-size:5.12vw}}a{transition:color .5s ease,border-color .5s ease,background .5s ease,opacity 1.5s ease;text-decoration:none;color:#000}a:focus,a:hover{transition:color .1s ease,border-color .1s ease,background .1s ease,opacity .1s ease;text-decoration:underline;-webkit-text-decoration-skip:ink;text-decoration-skip:ink}hr{border:0}::-moz-selection{background:rgba(108,181,252,.1)}::selection{background:rgba(108,181,252,.1)}::-moz-placeholder{opacity:.2;color:#000}:-ms-input-placeholder{opacity:.2;color:#000}::placeholder{opacity:.2;color:#000}:focus::-moz-placeholder{color:#6cb5fc}:focus:-ms-input-placeholder{color:#6cb5fc}:focus::placeholder{color:#6cb5fc}.navigation{font-size:60%;margin-right:-1.1em;margin-left:-1.1em;padding-top:1.4vmax;padding-bottom:1.4vmax;letter-spacing:.45em;text-transform:uppercase}.navigation li{line-height:2;display:inline-block;list-style:none}.navigation li a{padding:.5em 1.2em}.navigation li a:focus,.navigation li a:hover{text-decoration:none;color:#6cb5fc}.content{margin-bottom:16vmin}.content:after,.content:before{display:table;content:''}.content .post-content>:first-child,.content .post-content>:first-child>:first-child{margin-top:0}.content p{line-height:1.71428571;margin-bottom:1.6rem}.content header{display:-ms-flexbox;display:flex;flex-direction:column;min-height:calc(100vh - 5.6vmax - 5ex);margin-right:-22vw;margin-bottom:16vmin;margin-left:-22vw;background:rgba(0,0,0,.02);-ms-flex-direction:column;-ms-flex-pack:center;justify-content:center;padding:10vmin 22vw}@media (max-width:1080px){.content header{min-height:calc(64vh - 1.4vmax * 2 - 3ex);margin-right:-8vw;margin-left:-8vw;padding:16vmin 8vw}}@media (max-width:640px){.content header{margin-right:-4vw;margin-left:-4vw;padding-right:4vw;padding-left:4vw}}.content header h1{font-size:360%;font-weight:700;line-height:1.1;margin-left:-2px;letter-spacing:-.04em;-webkit-hyphens:none;hyphens:none;-webkit-font-smoothing:antialiased;-ms-hyphens:none}.content header small{display:block;margin-top:2vmin}.content h3{font-weight:400;margin:10vmin 0 1rem}@media (max-width:640px){.content header h1{font-size:280%}}.content blockquote{font-size:90%;position:relative;margin-bottom:2.8rem;margin-left:calc(-1.2vw - 2px)}.content blockquote>p{margin-bottom:0;padding-bottom:1.6rem;padding-left:1.2vw;opacity:.6;border-left:2px solid}.content blockquote>p:last-of-type{margin-bottom:1.6rem;padding-bottom:0}@media (max-width:640px){.content blockquote{margin-left:0}.content blockquote>p{margin-right:-4vw;margin-left:-4vw;padding-right:4vw;padding-left:calc(4vw - 2px)}}.content hr::before{content:'';display:block}.content hr::before{width:3px;height:3px;margin:2em auto;border-radius:50%;background:#000;box-shadow:24px 0 0 0 #000,-24px 0 0 0 #000}@media print{.content .post-content{max-width:100%!important}*,:after,:before{color:#000!important;background:0 0!important;box-shadow:none!important;text-shadow:none!important}body{margin:0!important;padding:10mm!important}a,a:visited{text-decoration:none}.content header{min-height:0;padding-bottom:0}blockquote{page-break-inside:avoid}h3,p{orphans:3;widows:3}h3{page-break-after:avoid}.navigation{display:none}}.content h3{font-size:96%;opacity:.7}.navigation{text-align:center}</style> <link rel=canonical href=http://blog.cee.moe/dear-assembly-2.html> <meta property=og:type content=article> <meta property=og:site_name content="Perfect Freeze!"> <meta property=og:title content="Dear Assembly（2）"> <meta property=og:url content=http://blog.cee.moe/dear-assembly-2.html> <meta property=og:description content=继续我们的拆炸弹之旅~> <meta name=twitter:card content=summary> <meta name=twitter:title content="Dear Assembly（2）"> <meta name=twitter:url content=http://blog.cee.moe/dear-assembly-2.html> <meta name=twitter:description content=继续我们的拆炸弹之旅~> <meta property=article:published_time content=2014-07-30T00:00:00+08:00> <meta property=article:modified_time content=2016-08-18T11:53:25+08:00> <meta name=twitter:label1 value=Words> <meta name=twitter:data1 value="249 words"> <meta name=twitter:label2 value="Reading time"> <meta name=twitter:data2 value="1 min"> <meta name=twitter:site content=@Ceecirno> <meta name=twitter:creator content=@Ceecirno> <nav class=navigation> <ul> <li> <a href=/ > Home </a> </li> <li> <a href=/articles/ > Articles </a> </li> <li> <a href=/works/ > Works </a> </li> <li> <a href=/friends/ > Friends </a> </li> <li> <a href=/about/ > About </a> </li> </ul> </nav> <main class=content role=main> <article> <header> <h1 title="Dear Assembly（2）" data-title="Dear Assembly（2）"> Dear Assembly（2）<span class="dot dot--post"> </span> </h1> <small> By <span rel=author>Cee</span> on <time datetime=2014-07-30T00:00:00+08:00>Jul 30, 2014</time> </small> </header> <div class=post-content> <blockquote> <p>继续我们的拆炸弹之旅~</p> </blockquote> <hr> <h3 id=phase6>Phase_6</h3> <p>作业的要求也就是做到 phase_5，但是很感兴趣所以继续往下做~</p> <script src=https://gist.github.com/cee/484ffb088d2130999a67.js></script> <p>代码如上。</p> <p>第 4 行的 <code class=highlighter-rouge>strtol</code> 函数：字符串按照 10 进制转换成长整形，这里不再赘述（就是得到输入的数）。并且第 5 行把它放在了 <code class=highlighter-rouge>node0</code> 中。</p> <p>目光投向第 12 行的 <code class=highlighter-rouge>cmp</code>（很重要啊混蛋！），<code class=highlighter-rouge>%edx == *(%rax)</code>，往上再看三行相当于 <code class=highlighter-rouge>%rax = %rax + 8</code> 做了 3 次，指针向后移动了三个 address 长度。再来分析 <code class=highlighter-rouge>fun6</code> 究竟做了什么：</p> <script src=https://gist.github.com/cee/b5dca8183efedd5abf21.js></script> <p class="leading-indent-fix leading-indent-fix--fullwidth-parenthesis">（<code class=highlighter-rouge>fun6</code> 就是长长长+看不懂！）</p> <p>尽管如此还是得继续，手写一下各个寄存器的转化，分析一下 <code class=highlighter-rouge>fun6</code> 的作用：排序。</p> <p>题目就转换成对所有数排序后第四个数是否等于输入的数，观察一下 <code class=highlighter-rouge>node1</code> 到 <code class=highlighter-rouge>node9</code> ，答案也就出来了：</p> <blockquote> <p>取 600 ~ 673（分别对应 <code class=highlighter-rouge>node8</code> 和 <code class=highlighter-rouge>node6</code>）中的任意一个整数</p> </blockquote> <h3 id=secretphase>Secret_Phase</h3> <p>最好玩的莫过于做完了布置的作业继续探索了！Let’s Go On！</p> <p>说到 Secret Phase，第一次看到是因为用 <code class=highlighter-rouge>x /32c</code> 看格式化字符串的时候发现了：</p> <blockquote> <p>austinpowers</p> </blockquote> <p>后来发现在每个 phase 做完后的 <code class=highlighter-rouge>phase_defused</code> 有个调用：</p> <script src=https://gist.github.com/cee/118c76e20cc232aabdaf.js></script> <p>顺藤摸瓜，看了一下地址在 <code class=highlighter-rouge>0x401ec4</code> 中的格式化字符串：</p> <blockquote> <p>%d %s</p> </blockquote> <p>并且和 <code class=highlighter-rouge>austinpowers</code> 比较了。并且 <code class=highlighter-rouge>0x603030</code> 这个入口也就是第四题的输入，即在 ⑨ 后面加上 <code class=highlighter-rouge>austinpowers</code> 就进入了 <code class=highlighter-rouge>secret_phase</code>。</p> <p>最后来看一下 <code class=highlighter-rouge>secret_phase</code> 和调用的 <code class=highlighter-rouge>fun7</code>：</p> <script src=https://gist.github.com/cee/f703ad785c8aa3fd8337.js></script> <script src=https://gist.github.com/cee/c68cded3572f66e29759.js></script> <p>这里建立了一棵树，他的数据结构就是节点自身和左右孩子。第 15 行的 <code class=highlighter-rouge>cmp</code>（跟你们说了很重要！）函数要求我们 <code class=highlighter-rouge>fun7</code> 的返回值是 3。画出树得到最后的答案：</p> <blockquote> <p>107</p> </blockquote> <p>撒花，成绩就是 <code class=highlighter-rouge>62.5/50</code> 了！</p> <h3 id=about-gdb>About GDB</h3> <p>关于 gdb 这里也想谈谈。</p> <p>通过这次的 lab 作业提升了很多关于 gdb 调试的技巧。</p> <p>给大家列一些常用的命令吧~</p> <p><code class=highlighter-rouge>gdb &lt;file&gt;</code>: 开始调试&gt;&lt;</p> <p><code class=highlighter-rouge>run</code>, <code class=highlighter-rouge>quit</code>: 开始和退出</p> <p><code class=highlighter-rouge>break func/*0x804820</code>: 给 <code class=highlighter-rouge>func</code> 函数/在地址为 <code class=highlighter-rouge>0x804820</code> 处设置断点</p> <p><code class=highlighter-rouge>delete/disable/enable 1</code>: 删除/禁用/启用断点 1（自动标号）</p> <p><code class=highlighter-rouge>stepi</code>: 执行一条指令</p> <p><code class=highlighter-rouge>nexti</code>: 执行一条指令，但是在函数调用中不停止</p> <p><code class=highlighter-rouge>step</code>: 执行一条C指令</p> <p><code class=highlighter-rouge>disassemble func/0x804820</code>: 查看 <code class=highlighter-rouge>func</code> 函数/地址在 <code class=highlighter-rouge>0x804820</code> 的汇编语句</p> <p><code class=highlighter-rouge>print /x $rip</code>: 16进制输出PC</p> <p><code class=highlighter-rouge>print /d $rip</code>: 10进制输出PC</p> <p><code class=highlighter-rouge>print /t $rip</code>: 2进制输出PC</p> <p><code class=highlighter-rouge>x /[NUM][SIZE][FORMAT] where</code>: 指定格式输出，<code class=highlighter-rouge>NUM</code> 位数，<code class=highlighter-rouge>SIZE</code> 代表每一位的大小（例如 b=byte，w=word，g=giant），<code class=highlighter-rouge>FORMAT</code> 代表格式（x，d，t），<code class=highlighter-rouge>WHERE</code> 代表地址。</p> <p><code class=highlighter-rouge>info r</code>: 查看寄存器</p> <h3 id=references>References</h3> <p><a href=http://lifeofzjs.com/blog/2014/02/03/csapp-bomb-lab/ >CSAPP Bomb Lab</a></p> <hr> <h3 id=whats-next>What’s Next</h3> <blockquote> <p>下一篇会主要介绍一下 lab3 的缓存区攻击的作业。</p> </blockquote> <footer class=post-modified-date> <p> Updated <time datetime=" 2016-08-18T11:53:25+08:00 "> Thursday, Aug 18, 2016 </time> </p> </footer> </div> </article> </main> <footer class=footer> <ul> <li><a href=/ >Perfect Freeze!</a></li> <li><a href=https://github.com/Cee title=GitHub>GitHub</a></li> <li><a href=https://github.com/PerfectFreeze title="Perfect Freeze - Lab">Lab</a></li> <li><a href=/feed.xml title="Feed - Atom (The Atom Syndication Format)">Atom</a></li> </ul>  <script>!function(){var e=document,t=e.createElement("script");t.src="//perfectfreeze.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script> <noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript> </footer>   <script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-48656879-8","auto"),ga("send","pageview")</script> 